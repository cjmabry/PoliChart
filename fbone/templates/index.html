{% extends 'layouts/base.html' %}

{% set page_title = 'Home' %}

{% block top %}
{% endblock %}

{% block body %}
<div class="jumbotron">
    <h1>Delegate Projections</h1>
    <p>This tool allocates pledged delegates to candidates based on their recent polling in each state. To make these projections we assume polling is 100% accurate (it's not) and delegates are awarded exactly proportionally to the percentage vote (in reality, delegates awarded can differ slightly from the popular vote).</p>

    <p>Delegates from states with few or no polls are not alocated to either candidate, and superdelegates are not supported at this time.</p>

    <h2>Hillary Clinton: {{ data.projections.clinton }}</h2>
    <h2>Bernie Sanders: {{ data.projections.sanders }}</h2>

    <small>Polling data from <a href="http://elections.huffingtonpost.com/pollster#2016-primaries">HuffPost Pollster</a></small>
</div>

<div class="panel panel-default table-responsive">
  <!-- Default panel contents -->
  <div class="panel-heading"><strong>State Breakdowns</strong></div>

  <!-- Table -->
  <table class="table table-condensed table-striped table-hover" id="state-data">
    <thead>
      <tr>
        <th colspan='1'></th>
        <th colspan='1' scope='colgroup'>Delegates</th>
        <th colspan='2' scope='colgroup'>Polling</th>
        <th colspan='2' scope='colgroup'>Results</th>
        <th colspan='3' scope='colgroup'>Projected Delegates</th>
        <th colspan='2' scope='colgroup'>Awarded Delegates</th>
        <th colspan='1'></th>
      </tr>
      <tr>
        <th scope='col'>State</th>
        <th scope='col'>Pledged</th>
        <!-- <th scope='col'>Unpledged</th> -->
        <!-- <th scope='col'>Total</th> -->
        <th scope='col'>Clinton</th>
        <th scope='col'>Sanders</th>
        <!-- <th scope='col'>Undecided</th> -->
        <th scope='col'>Clinton</th>
        <th scope='col'>Sanders</th>
        <th scope='col'>Clinton</th>
        <th scope='col'>Sanders</th>
        <th scope='col'>Undecided</th>
        <th scope='col'>Clinton</th>
        <th scope='col'>Sanders</th>
        <th scope='col' class='sort-default'>Election Date</th>
      </tr>
    </thead>
    <tbody>
      {% for state in data.states %}
        {% if state.state != 'US' %}
          <tr>
            <td><strong>{{ state.state }}</strong></td>
            <td>{{ state.pledged_available }}</td>
            <!-- <td>{{ state.unpledged_available }}</td> -->
            <!-- <td>{{ state.unpledged_available + state.pledged_available }}</td> -->
            <td>
              {% if state.url %}
                <a href="{{state.url}}">{{ state.clinton_percentage * 100 }}%</a>
              {% else %}
                {{ state.clinton_percentage * 100 }}%
              {% endif %}
          </td>
            <td>
              {% if state.url %}
                <a href="{{state.url}}">{{ state.sanders_percentage * 100 }}%</a>
              {% else %}
                {{ state.sanders_percentage * 100 }}%
              {% endif %}
            </td>
            <!-- <td>{{ 100 - (state.sanders_percentage + state.clinton_percentage) * 100}}%</td> -->
            <td>-</td>
            <td>-</td>
            <td>{{ state.clinton_delegates | int }}</td>
            <td>{{ state.sanders_delegates | int}}</td>
            <td>{{ state.pledged_available - (state.sanders_delegates + state.clinton_delegates) | int}}</td>
            <td>-</td>
            <td>-</td>
            <td>{{ state.election_date.strftime('%m/%d/%Y') }}</td>
          </tr>
        {% endif %}
      {% endfor %}

      {% for state in data.states %}
        {% if state.state == 'US' %}
        <tr class="panel-footer no-sort">
          <td><strong>TOTAL</strong></td>
          <td>{{ state.pledged_available }}</td>
          <!-- <td>{{ state.unpledged_available }}</td> -->
          <!-- <td>{{ state.unpledged_available + state.pledged_available }}</td> -->
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <!-- <td>-</td> -->
          <td>-</td>
          <td>{{ data.projections.clinton }}</td>
          <td>{{ data.projections.sanders }}</td>
          <td>{{ data.projections.undecided }}</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>
</div>
<script src="{{ url_for('static', filename='js/tablesort.js') }}"></script>
<script src="{{ url_for('static', filename='js/tablesort.date.js') }}"></script>
<script src="{{ url_for('static', filename='js/tablesort.number.js') }}"></script>
<script>
  new Tablesort(document.getElementById('state-data'));
</script>
{% endblock %}
